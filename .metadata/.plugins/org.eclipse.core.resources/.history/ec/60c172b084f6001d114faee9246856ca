package scene; 

import jeu.Elements;
import main.Main;
import javafx.scene.paint.Color;
import javafx.scene.shape.*;

import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;

import javax.imageio.ImageIO;

import javafx.embed.swing.SwingFXUtils;
import javafx.scene.canvas.Canvas;
import javafx.scene.canvas.GraphicsContext;
import javafx.scene.image.Image;
import javafx.scene.layout.*;
import java.util.ArrayList;


public class View extends Pane{
	
	private static int tailleQuadrillage;
	private Elements jeu;
	private Canvas canvas;
	private ArrayList<Object> listObjects;

	public View(int tailleQuadrillage, Elements jeu) throws IOException {
		super();
		this.setJeu(jeu);
		View.tailleQuadrillage = tailleQuadrillage;
		listObjects = new ArrayList<Object>();
		canvas=new Canvas(Main.sceneX,Main.sceneY);
		
		GraphicsContext gc = canvas.getGraphicsContext2D();
		
		//ajout du fond
		BufferedImage bufBg = ImageIO.read(getClass().getResource("/herbe.png"));
		Image bgImg = SwingFXUtils.toFXImage(bufBg, null);
		BackgroundImage bgView = new BackgroundImage(bgImg, BackgroundRepeat.REPEAT, BackgroundRepeat.REPEAT, BackgroundPosition.DEFAULT, BackgroundSize.DEFAULT);
		Background bg = new Background(bgView);
		this.setBackground(bg);
		
		//affichage du quadrillage
		Quadrillage quad = new Quadrillage(tailleQuadrillage, Main.sceneX, Main.sceneY);
		for(Line l : quad.getLignes()) {
			gc.setStroke(Color.DARKGREY);
            gc.strokeLine(l.getStartX(), l.getStartY(), l.getEndX(), l.getEndY());
		}
		this.getChildren().add(canvas);
		jeu.setCaseMaxX(quad.getCaseMaxX());
		jeu.setCaseMaxY(quad.getCaseMaxY());

		
		//ajout de l'arrivée
		StaticObject arrivee = new StaticObject("/arrivee.png", convertCasetoPos(8), convertCasetoPos(7), tailleQuadrillage, false);
		listObjects.add(arrivee);
		jeu.setGoal(arrivee);
		
		//ajout du perso dans les objets
		Personnage perso = new Personnage("toto", "/Homme.png", convertCasetoPos(3), convertCasetoPos(4), tailleQuadrillage, true);
		listObjects.add(perso);
		jeu.addPerso(perso);
		Personnage perso2 = new Personnage("tata", "/Homme.png", convertCasetoPos(5), convertCasetoPos(2), tailleQuadrillage, true);
		listObjects.add(perso2);
		jeu.addPerso(perso2);
		
		//ajout des objets à la scène
		for(Object o : listObjects) {
			this.getChildren().add(o.getView());
		}
	}

	
	public int convertCasetoPos(int numCase) {
		return (numCase-1)*tailleQuadrillage;
	}
	
	public static int convertPostoCase(int pos) {
		return (pos/tailleQuadrillage) + 1;
	}


	public  int getTailleQuadrillage() {
		return tailleQuadrillage;
	}


	public Elements getJeu() {
		return jeu;
	}


	public void setJeu(Elements jeu) {
		this.jeu = jeu;
	}
}
