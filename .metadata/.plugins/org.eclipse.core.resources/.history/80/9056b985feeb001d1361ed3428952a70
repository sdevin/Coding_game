package scene; 

import javafx.scene.paint.Color;
import javafx.scene.shape.*;

import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;

import javax.imageio.ImageIO;

import javafx.embed.swing.SwingFXUtils;
import javafx.scene.canvas.Canvas;
import javafx.scene.canvas.GraphicsContext;
import javafx.scene.image.Image;
import javafx.scene.layout.*;
import java.util.ArrayList;


public class View extends StackPane{
	
	private static int tailleQuadrillage = 100;
	private Canvas canvas;
	private ArrayList<Object> listObjects;

	public View(int sceneX, int sceneY) throws IOException {
		super();
		listObjects = new ArrayList<Object>();
		canvas=new Canvas(sceneX,sceneY);
		
		GraphicsContext gc = canvas.getGraphicsContext2D();
		
		//ajout du fond
		BufferedImage bufBg = ImageIO.read(new File("images/herbe.png"));
		Image bgImg = SwingFXUtils.toFXImage(bufBg, null);
		BackgroundImage bgView = new BackgroundImage(bgImg, BackgroundRepeat.REPEAT, BackgroundRepeat.REPEAT, BackgroundPosition.DEFAULT, BackgroundSize.DEFAULT);
		Background bg = new Background(bgView);
		//this.setBackground(bg);
		
		//ajout du perso dans les objets
		Personnage perso = new Personnage("toto", "images/Homme.png", convertCasetoPos(3), convertCasetoPos(4), tailleQuadrillage, true);
		listObjects.add(perso);
		
		//affichage du quadrillage
		Quadrillage quad = new Quadrillage(tailleQuadrillage, sceneX, sceneY);
		for(Line l : quad.getLignes()) {
			gc.setStroke(Color.DARKGREY);
            gc.strokeLine(l.getStartX(), l.getStartY(), l.getEndX(), l.getEndY());
		}
		//this.getChildren().add(canvas);
		
		//ajout des objets à la scène
		for(Object o : listObjects) {
			this.getChildren().add(o.getView());
			System.out.println("ajout objet : " + o.getImageName());
		}
	}

	
	private static int convertCasetoPos(int numCase) {
		return (numCase%tailleQuadrillage) + tailleQuadrillage/2;
	}
}
